<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>冷露清风</title>
  <meta name="author" content="shm">
  
  <meta name="description" content="Another hexo blog">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="冷露清风"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="冷露清风" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">冷露清风</a></h1>
  <h2><a href="/">幽兰花，为谁好，露冷风清香自老</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
      <li><a href="/about">About</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-09-26T04:37:38.000Z"><a href="/2015/09/26/security-configuration-for-linux-root-user/">2015-09-26</a></time>
      
      
  
    <h1 class="title"><a href="/2015/09/26/security-configuration-for-linux-root-user/">Root 安全配置</a></h1>
  

    </header>
    <div class="entry">
      
        <h2 id="修改_root_用户名">修改 root 用户名</h2><p>将 /etc/passwd 与 /etc/shadow 第一列的 root 改为想要的管理员名称</p>
<h2 id="禁用_root_密码登录">禁用 root 密码登录</h2><p>修改 /etc/ssh/sshd_config ：<br>PermitRootLogin without-password</p>
<h2 id="配置_ssh_密钥登录">配置 ssh 密钥登录</h2><p><strong>方法一：</strong>服务器端.ssh/authorized_keys 文件添加客户端的公钥，配置文件权限为644<br><strong>方法二：</strong>客户端指定使用服务器端的私钥登录,务必保存好私钥</p>
<h2 id="禁用其它用户_sudo_切换到_root">禁用其它用户 sudo 切换到 root</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># visudo 注释掉下面内容</span></span><br><span class="line"><span class="comment"># Allow members of group sudo to execute any command</span></span><br><span class="line"><span class="comment"># %sudo   ALL=(ALL:ALL) ALL</span></span><br><span class="line"><span class="comment"># shm     ALL=(ALL:ALL) NOPASSWD:ALL</span></span><br></pre></td></tr></table></figure>
<h2 id="ssh_三个信息级别：">ssh 三个信息级别：</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh -v</span><br><span class="line">ssh -vv</span><br><span class="line">ssh -vvv</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-09-26T04:35:09.000Z"><a href="/2015/09/26/hotlink-protection-in-nginx/">2015-09-26</a></time>
      
      
  
    <h1 class="title"><a href="/2015/09/26/hotlink-protection-in-nginx/">Nginx 防盗链设置</a></h1>
  

    </header>
    <div class="entry">
      
        <h2 id="Hotlink_Protection"><font color="blue"><strong>Hotlink Protection</strong> </font></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location ~ \.(jpe?g|png|gif)$ &#123;</span><br><span class="line">     valid_referers none blocked mysite.com *.mysite.com;</span><br><span class="line">     <span class="keyword">if</span> (<span class="variable">$invalid_referer</span>) &#123;</span><br><span class="line">        <span class="built_in">return</span>   <span class="number">403</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location /images/ &#123;</span><br><span class="line">     valid_referers none blocked mysite.com *.mysite.com;</span><br><span class="line">     <span class="keyword">if</span> (<span class="variable">$invalid_referer</span>) &#123;</span><br><span class="line">        <span class="built_in">return</span>   <span class="number">403</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>none - Matches the requests with no Referrer header.<sup>[1]</sup></li>
<li>blocked - Matches the requests with blocked Referrer  header.<sup>[1]</sup></li>
<li><em>.mydomain.com - Matches all the sub domains of mydomain.com. Since v0.5.33, </em> wildcards can be used in the server names.<sup>[1]</sup></li>
</ul>
<h2 id="Blocked_Referer"><font color="blue"><strong>Blocked Referer</strong> </font></h2><ol>
<li>Type “about:config” </li>
<li>type “referer”, check network.http.sendRefererHeader. This is probably set to 2.</li>
<li>modify network.http.sendRefererHeader to 0, or 1.</li>
</ol>
<p>Setting sendRefererHeader to 0, This completely disables the referer header. This is normally what you want, though it may occasionally break a few sites that check the referer header to prevent deep linking or framing of its content. (It breaks WordPress, for example.)<sup>[2]</sup></p>
<p>Setting sendRefererHeader to 1 sends a referer header when following a link to another page, but not when loading images on the page. This will block most cross-site cookie tracking, but still allow WordPress and most other sites that depend on referers to function. <sup>[2]</sup></p>
<p>Setting sendRefererHeader to 2 (the default) sends it when following links and when loading images on the page.<sup>[2]</sup></p>
<p>There’s also a boolean, network.http.sendSecureXSiteReferer preference. If true, referer headers are sent for https the same as they are for http (i.e. controlled by network.http.sendRefererHeader). If false, referer headers are not sent for https connections. The default is true, and that’s probably OK.<sup>[2]</sup></p>
<p>Reference:<br>&ensp;&ensp;[1] <a href="http://nginxlibrary.com/hotlink-protection/" target="_blank" rel="external">http://nginxlibrary.com/hotlink-protection/</a><br>&ensp;&ensp;[2] <a href="http://cafe.elharo.com/privacy/privacy-tip-3-block-referer-headers-in-firefox/" target="_blank" rel="external">http://cafe.elharo.com/privacy/privacy-tip-3-block-referer-headers-in-firefox/</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-09-24T12:59:51.000Z"><a href="/2015/09/24/lookup-server-information-by-ip-address/">2015-09-24</a></time>
      
      
  
    <h1 class="title"><a href="/2015/09/24/lookup-server-information-by-ip-address/">通过 IP 查找服务器</a></h1>
  

    </header>
    <div class="entry">
      
        <p>Reference: </p>
<p>需要重启一台服务器，服务器能 ping 通，但无法远程。一时找不到该服务器的记录，可通过如下步骤获得服务器的信息</p>
<ol>
<li>通过 nmap -T4 -A <ipaddr> 扫描服务器开放的服务和得到可能的操作系统。</ipaddr></li>
<li>同网段 ping ip，然后通过 arp -a 得到 IP 的 MAC</li>
<li>网上查找 <a href="http://www.macvendorlookup.com/" target="_blank" rel="external">MAC 对应厂商</a> ，确认机器类型，品牌</li>
<li>通过交换机查找 arp 记录得到该 MAC 对应的交换机端口，如是物理机，即可得到位置，如果是桥接网络的虚拟机，执行下一步</li>
<li>通过交换机查找 arp 记录得到该交换机端口对应的所有 IP, 从中找到虚拟机的宿主机</li>
</ol>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-09-24T12:36:11.000Z"><a href="/2015/09/24/how-to-deal-with-server-fault/">2015-09-24</a></time>
      
      
  
    <h1 class="title"><a href="/2015/09/24/how-to-deal-with-server-fault/">服务器故障处理及日志分析</a></h1>
  

    </header>
    <div class="entry">
      
        <p>Reference: </p>
<h2 id="检查服务器情况">检查服务器情况</h2><ul>
<li>系统 CPU/Memory/Process 使用</li>
<li>sockets 连接数</li>
<li>检查应用程序池</li>
<li>检查网站正在处理请求</li>
<li>检查系统日志</li>
<li>检查虚拟机 CPU/Memory/Network 统计情况</li>
</ul>
<h2 id="分析访问日志">分析访问日志</h2><h3 id="Linux_分析脚本">Linux 分析脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 统计客户端 IP:</span></span><br><span class="line">grep -v ^<span class="comment"># $logfile| awk '&#123;++sum[$9]&#125;END&#123;for (i in sum)print i,sum[i]&#125;'|sort -n -r -k 2 |head</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计 http_code</span></span><br><span class="line">grep -v ^<span class="comment"># $logfile| awk '&#123;++sum[$11]&#125;END&#123;for (i in sum)print i,sum[i]&#125;'|sort -n -r -k 2 |head</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计 User-agent</span></span><br><span class="line">grep -v ^<span class="comment"># $logfile| awk '&#123;++sum[$10]&#125;END&#123;for (i in sum)print i,sum[i]&#125;'|sort -n -r -k 2 |head</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计请求(cs-uri-stem)</span></span><br><span class="line">grep -v ^<span class="comment"># $logfile| awk '&#123;++sum[$5]&#125;END&#123;for (i in sum)print i,sum[i]&#125;'|sort -n -r -k 2 |head</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计请求(cs-uri-query)</span></span><br><span class="line">grep -v ^<span class="comment"># $logfile| awk '&#123;++sum[$6]&#125;END&#123;for (i in sum)print i,sum[i]&#125;'|sort -n -r -k 2 |head</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 时间花费最多的请求</span></span><br><span class="line">grep -v ^<span class="comment"># $logfile| awk '&#123;if ($NF &gt; 300)&#123;print $5,$NF&#125;&#125;'|sort -n -r -k 2 | head</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 平均每个请求时间</span></span><br><span class="line">grep -v ^<span class="comment"># $logfile| awk '&#123;if ($NF &gt; 300)&#123;++sum[$5];time[$5]+=$NF&#125;&#125;END&#123;for(i in sum) print i,sum[i],time[i]/sum[i]&#125;'|sort -n -r -k 2|head</span></span><br></pre></td></tr></table></figure>
<h3 id="IIS_Log_Parser_分析">IIS Log Parser 分析</h3><p>IIS Log Parser 是微软的日志分析工具可直接使用 sql 查询统计日志，较为方便，同时有对应的图形化工具 IIS Log Parser Studio，Log Parser Studio 依赖于Log Parser，内包含了常用的查询，使用起来更方便些。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 首先设置日志路径，可使用 * 匹配多个日志</span></span><br><span class="line"><span class="built_in">set</span> logfile=E:\information\shm\iislog\u_ex150924.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计客户端 IP:</span></span><br><span class="line">logparser -i:iisw3c <span class="string">"select c-ip,count(1) as sum from %logfile% group by c-ip order by count(1) desc"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计 http_code</span></span><br><span class="line">logparser -i:iisw3c <span class="string">"select sc-status,count(1) as sum from %logfile% group by sc-status"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计 User-agent</span></span><br><span class="line">logparser -i:iisw3c <span class="string">"select cs(User-Agent),count(1) as sum from %logfile% group by cs(User-Agent) order by count(1) desc"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计用户请求 cs-uri-stem</span></span><br><span class="line">logparser -i:iisw3c <span class="string">"select cs-uri-stem,count(1) as sum from %logfile% group by cs-uri-stem order by count(1) desc"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># win32 status 统计</span></span><br><span class="line">logparser -i:iisw3c </span><br><span class="line"><span class="string">"SELECT  </span><br><span class="line">    sc-win32-status As Win32-Status, </span><br><span class="line">    COUNT(*) AS Hits,  </span><br><span class="line">    WIN32_ERROR_DESCRIPTION(sc-win32-status) as Description</span><br><span class="line">    FROM %logfile%  </span><br><span class="line">WHERE Win32-Status&lt;&gt;0  </span><br><span class="line">GROUP BY Win32-Status  </span><br><span class="line">ORDER BY Hits DESC"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询次数多，耗时长请求</span></span><br><span class="line">logparser -i:iisw3c <span class="string">"select cs-uri-stem,max(time-taken) as maxtime,avg(time-taken) as avgtime,min(time-taken) as mintime,count(1) as count from %logfile% where time-taken&gt;30 group by cs-uri-stem order by count(1),avg(time-taken) desc"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 按请求大小排序</span></span><br><span class="line">logparser -i:iisw3c <span class="string">"select cs-uri-stem,max(sc-bytes) as maxsize,avg(sc-bytes) as avgsize,min(sc-bytes) as minsize,count(1) as count from %logfile% group by cs-uri-stem order by avg(sc-bytes) desc"</span></span><br></pre></td></tr></table></figure>
<h3 id="IIS_log_Fields">IIS log Fields</h3><pre><code>date：发出请求时候的日期。
time：发出请求时候的时间。注意：默认情况下这个时间是格林威治时间，比我们的北京时间晚8个小时，下面有说明。
c-ip：客户端IP地址。
<span class="keyword">cs</span>-username：用户名，访问服务器的已经过验证用户的名称，匿名用户用连接符-表示。
s-sitename：服务名，记录当记录事件运行于客户端上的Internet服务的名称和实例的编号。
s-computername：服务器的名称。
s-ip：服务器的IP地址。
s-port：为服务配置的服务器端口号。
<span class="keyword">cs</span>-method：请求中使用的HTTP方法，GET/<span class="keyword">POST</span>。
<span class="keyword">cs</span>-uri-<span class="keyword">stem</span>：URI资源，记录做为操作目标的统一资源标识符（URI），即访问的页面文件。   
<span class="keyword">cs</span>-uri-<span class="keyword">query</span>：URI查询，记录客户尝试执行的查询，只有动态页面需要URI查询，如果有则记录，没有则以连接符-表示。即访问网址的附带参数。   
<span class="keyword">sc</span>-status：协议状态，记录HTTP状态代码，200表示成功，403表示没有权限，404表示找不到该页面，具体说明在下面。
<span class="keyword">sc</span>-substatus：协议子状态，记录HTTP子状态代码。   
<span class="keyword">sc</span>-win32-status：Win32状态，记录Windows状态代码。   
<span class="keyword">sc</span>-bytes：服务器发送的字节数。   
<span class="keyword">cs</span>-bytes：服务器接受的字节数。   
time-taken：记录操作所花费的时间，单位是毫秒。   
<span class="keyword">cs</span>-<span class="keyword">version</span>：记录客户端使用的协议版本，HTTP或者FTP。   
<span class="keyword">cs</span>-host:记录主机头名称，没有的话以连接符-表示。注意：为网站配置的主机名可能会以不同的方式出现在日志文件中，原因是HTTP.sys使用Punycode编码格式来记录主机名。  
<span class="keyword">cs</span>(User-Agent)：用户代理，客户端浏览器、操作系统等情况。   
<span class="keyword">cs</span>(Cookie)：记录发送或者接受的Cookies内容，没有的话则以连接符-表示。   
<span class="keyword">cs</span>(Referer)：引用站点，即访问来源。
</code></pre>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-09-23T19:31:29.000Z"><a href="/2015/09/24/git-learning/">2015-09-24</a></time>
      
      
  
    <h1 class="title"><a href="/2015/09/24/git-learning/">Git 学习笔记</a></h1>
  

    </header>
    <div class="entry">
      
        <p>Reference: <a href="http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000" target="_blank" rel="external"><strong>廖雪峰的官方网站-Git 教程</strong></a></p>
<p>文章绝大部分内容及文字来自 《廖雪峰的官方网站-Git 教程》，个人只作简要整理，以便个人记忆及查找。</p>
<h2 id="安装">安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">aptitude install git</span><br><span class="line">aptitude install git-core //old version name</span><br></pre></td></tr></table></figure>
<h2 id="全局配置">全局配置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name <span class="string">"suhaiming"</span></span><br><span class="line">git config --global user.email <span class="string">"sualwu@gmail.com"</span></span><br><span class="line">git config --global color.ui <span class="literal">true</span> <span class="comment"># 显示颜色</span></span><br><span class="line"><span class="comment"># 注意git config命令的--global参数，用了这个参数，表示你这台机器上所有的Git仓库都会使用这个配置，当然也可以对某个仓库指定不同的用户名和Email地址</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">➜  ~  git config --global --list  </span><br><span class="line">user.name=suhaiming</span><br><span class="line">user.email=sualwu@gmail.com</span><br><span class="line">merge.tool=vimdiff</span><br><span class="line">color.ui=auto</span><br><span class="line">color.status=auto</span><br><span class="line">color.branch=auto</span><br><span class="line"></span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">➜  ~  cat ./home/shm/gitconfig </span><br><span class="line">[user]</span><br><span class="line">	name = suhaiming</span><br><span class="line">	email = sualwu@gmail.com</span><br><span class="line">[merge]</span><br><span class="line">	tool = vimdiff</span><br><span class="line">[color]</span><br><span class="line">	ui = auto</span><br><span class="line">	status = auto</span><br><span class="line">	branch = auto</span><br></pre></td></tr></table></figure>
<h2 id="单独配置">单独配置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">git config user.name <span class="string">"suhaiming"</span></span><br><span class="line">git config user.email <span class="string">"sualwu@gmail.com"</span></span><br><span class="line"></span><br><span class="line">➜  learngo git:(master) ✗ git config --list</span><br><span class="line">user.name=suhaiming</span><br><span class="line">user.email=sualwu@gmail.com</span><br><span class="line">merge.tool=vimdiff</span><br><span class="line">color.ui=auto</span><br><span class="line">color.status=auto</span><br><span class="line">color.branch=auto</span><br><span class="line">core.repositoryformatversion=<span class="number">0</span></span><br><span class="line">core.filemode=<span class="literal">true</span></span><br><span class="line">core.bare=<span class="literal">false</span></span><br><span class="line">core.logallrefupdates=<span class="literal">true</span></span><br><span class="line">remote.origin.url=https://github.com/suhaiming/learngo.git</span><br><span class="line">remote.origin.fetch=+refs/heads/*:refs/remotes/origin/*</span><br><span class="line">branch.master.remote=origin</span><br><span class="line">branch.master.merge=refs/heads/master</span><br><span class="line"></span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">➜  learngo git:(master) ✗ cat .git/config </span><br><span class="line">[core]</span><br><span class="line">	repositoryformatversion = <span class="number">0</span></span><br><span class="line">	filemode = <span class="literal">true</span></span><br><span class="line">	bare = <span class="literal">false</span></span><br><span class="line">	logallrefupdates = <span class="literal">true</span></span><br><span class="line">[remote <span class="string">"origin"</span>]</span><br><span class="line">	url = https://github.com/suhaiming/learngo.git</span><br><span class="line">	fetch = +refs/heads/*:refs/remotes/origin/*</span><br><span class="line">[branch <span class="string">"master"</span>]</span><br><span class="line">	remote = origin</span><br><span class="line">	merge = refs/heads/master</span><br></pre></td></tr></table></figure>
<h2 id="创建版本库">创建版本库</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mkdir learngo</span><br><span class="line"><span class="built_in">cd</span> learngo</span><br><span class="line">git init <span class="comment">#init a repos</span></span><br><span class="line">git add filename <span class="comment">#add file to stages</span></span><br><span class="line"><span class="comment"># 每次修改，如果不add到暂存区，那就不会加入到commit中</span></span><br><span class="line"></span><br><span class="line">git commit -m <span class="string">"comment"</span>  <span class="comment">#commit file to repos</span></span><br><span class="line">git status <span class="comment">#current status</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化一个Git仓库，使用git init命令。</span></span><br><span class="line"><span class="comment"># 添加文件到Git仓库，分两步：</span></span><br><span class="line"><span class="comment">#  第一步，使用命令git add &lt;file&gt;，注意，可反复多次使用，添加多个文件；</span></span><br><span class="line"><span class="comment">#  第二步，使用命令git commit，完成。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 要随时掌握工作区的状态，使用git status命令。</span></span><br><span class="line"><span class="comment"># 如果git status告诉你有文件被修改过，用git diff可以查看修改内容。</span></span><br></pre></td></tr></table></figure>
<h2 id="版本回退">版本回退</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git diff //check modify content <span class="keyword">in</span> working directory and stage</span><br><span class="line">git diff HEAD -- file //check file diff <span class="keyword">in</span> working directory and last version(repos).</span><br><span class="line">git <span class="built_in">log</span></span><br><span class="line">git <span class="built_in">log</span> --pretty=oneline</span><br><span class="line">git <span class="built_in">log</span> --pretty=oneline --graph --abbrev-commit</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard HEAD^  <span class="comment"># return file to prev version</span></span><br><span class="line">git reset HEAD &lt;file&gt; <span class="comment"># to unstage</span></span><br><span class="line"><span class="comment">#git reset命令既可以回退版本，也可以把暂存区的修改回退到工作区。当我们用HEAD时，表示最新的版本。</span></span><br><span class="line"></span><br><span class="line">git checkout -- &lt;file&gt; <span class="comment">#discare changes in working directory</span></span><br><span class="line"><span class="comment">#命令git checkout -- readme.txt意思就是，把readme.txt文件在工作区的修改全部撤销，这里有两种情况：</span></span><br><span class="line"><span class="comment">#一种是readme.txt自修改后还没有被放到暂存区，现在，撤销修改就回到和版本库一模一样的状态；</span></span><br><span class="line"><span class="comment">#一种是readme.txt已经添加到暂存区后，又作了修改，现在，撤销修改就回到添加到暂存区后的状态。</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reflog <span class="comment"># log commit every time.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># HEAD指向的版本就是当前版本，因此，Git允许我们在版本的历史之间穿梭，使用命令git reset --hard commit_id。</span></span><br><span class="line"><span class="comment"># 穿梭前，用git log可以查看提交历史，以便确定要回退到哪个版本。</span></span><br><span class="line"><span class="comment"># 要重返未来，用git reflog查看命令历史，以便确定要回到未来的哪个版本。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 场景1：当你改乱了工作区某个文件的内容，想直接丢弃工作区的修改时，用命令git checkout -- file。</span></span><br><span class="line"><span class="comment"># 场景2：当你不但改乱了工作区某个文件的内容，还添加到了暂存区时，想丢弃修改，分两步，第一步用命令git reset HEAD file，就回到了场景1，第二步按场景1操作。</span></span><br><span class="line"><span class="comment"># 场景3：已经提交了不合适的修改到版本库时，想要撤销本次提交，参考版本回退一节，不过前提是没有推送到远程库。</span></span><br></pre></td></tr></table></figure>
<h2 id="删除">删除</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git rm filename</span><br><span class="line">git checkout -- filename <span class="comment"># 误删回退</span></span><br><span class="line"><span class="comment"># 命令git rm用于删除一个文件。如果一个文件已经被提交到版本库，那么你永远不用担心误删，但是要小心，你只能恢复文件到最新版本，你会丢失最近一次提交后你修改的内容。</span></span><br></pre></td></tr></table></figure>
<h2 id="远程仓库">远程仓库</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C <span class="string">"sualwu@gmail.com"</span></span><br><span class="line"><span class="comment"># 将 id_rsa.pub 粘贴到 github 网站</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先有本地库，后有远程库的时候，关联远程库。</span></span><br><span class="line">git remote add origin git@github.com:suhaiming/learngo.git</span><br><span class="line">git remote -v</span><br><span class="line">git push origin master</span><br><span class="line">git push -u origin master</span><br><span class="line"><span class="comment"># 由于远程库是空的，我们第一次推送master分支时，加上了-u参数，Git不但会把本地的master分支内容推送的远程新的master分支，还会把本地的master分支和远程的master分支关联起来，在以后的推送或者拉取时就可以简化命令</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先创建远程库，然后，从远程库克隆</span></span><br><span class="line">git <span class="built_in">clone</span> git@github.com:suhaiming/learngo.git</span><br><span class="line"><span class="comment"># 使用https除了速度慢以外，还有个最大的麻烦是每次推送都必须输入口令，但是在某些只开放http端口的公司内部就无法使用ssh协议而只能用https</span></span><br></pre></td></tr></table></figure>
<h2 id="分支管理">分支管理</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在版本回退里，你已经知道，每次提交，Git 都把它们串成一条时间线，这条时间线就是一个分支。截止到目前，只有一条时间线，在Git里，这个分支叫主分支，即master分支。HEAD严格来说不是指向提交，而是指向master，master才是指向提交的，所以，HEAD指向的就是当前分支</span></span><br><span class="line"></span><br><span class="line">git checkout -b dev //create new branch</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">git branch dev</span><br><span class="line">git checkout dev</span><br><span class="line"></span><br><span class="line">git branch <span class="comment"># list branch(* current)</span></span><br><span class="line">git merge <span class="operator">-d</span> dev <span class="comment"># merge dev branch to master</span></span><br><span class="line">git brancd <span class="operator">-d</span> dev <span class="comment"># delete dev branch</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Git鼓励大量使用分支：</span></span><br><span class="line"><span class="comment"># 查看分支：git branch</span></span><br><span class="line"><span class="comment"># 创建分支：git branch &lt;name&gt;</span></span><br><span class="line"><span class="comment"># 切换分支：git checkout &lt;name&gt;</span></span><br><span class="line"><span class="comment"># 创建+切换分支：git checkout -b &lt;name&gt;</span></span><br><span class="line"><span class="comment"># 合并某分支到当前分支：git merge &lt;name&gt;</span></span><br><span class="line"><span class="comment"># 删除分支：git branch -d &lt;name&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="解决冲突">解决冲突</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如何两个分支分别有新的提交， 合并时 Git 无法执行快速合并，只能试图把各自的修改合并起来，但这种合并有可能带来冲突，比如同时修改了同一文件</span></span><br><span class="line">➜  learngo git:(master) ✗ git merge dev</span><br><span class="line">Auto-merging readme.txt</span><br><span class="line">CONFLICT (content): Merge conflict <span class="keyword">in</span> readme.txt</span><br><span class="line">Automatic merge failed; fix conflicts and <span class="keyword">then</span> commit the result.</span><br><span class="line">➜  learngo git:(master) ✗ cat readme.txt|tail -n <span class="number">5</span></span><br><span class="line">...</span><br><span class="line">modify on master1</span><br><span class="line">=======</span><br><span class="line">add by dev</span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt; dev</span><br><span class="line"><span class="comment"># Git用&lt;&lt;&lt;&lt;&lt;&lt;&lt;，=======，&gt;&gt;&gt;&gt;&gt;&gt;&gt;标记出不同分支的内容，将冲突内容修改后再提交合并即可</span></span><br><span class="line">➜  learngo git:(master) ✗ git add readme.txt </span><br><span class="line">➜  learngo git:(master) ✗ git commit -m <span class="string">"resolve conflict"</span></span><br><span class="line">[master <span class="number">0</span>ada51a] resolve conflict</span><br><span class="line">➜  learngo git:(master) ✗ git <span class="built_in">log</span> --pretty=oneline --graph --abbrev-commit </span><br><span class="line">*   <span class="number">0</span>ada51a resolve conflict</span><br><span class="line">|\  </span><br><span class="line">| * <span class="number">9</span>b819e1 dev modify</span><br><span class="line">* | c649146 master modify</span><br><span class="line">|/  </span><br><span class="line"><span class="comment">#　用git log --graph命令可以看到分支合并图。</span></span><br></pre></td></tr></table></figure>
<h2 id="分支管理策略">分支管理策略</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通常，合并分支时，如果可能，Git会用Fast forward 模式，但这种模式下，删除分支后，会丢掉分支信息。</span></span><br><span class="line"></span><br><span class="line">git merge --no-ff -m <span class="string">"merge with no-ff"</span> dev</span><br><span class="line"><span class="comment"># 强制禁用Fast forward模式，Git就会在merge时生成一个新的commit，这样，从分支历史上就可以看出分支信息。-no-ff 禁用Fast forward, 以记录分支合并信息</span></span><br></pre></td></tr></table></figure>
<h2 id="Bug_分支">Bug 分支</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Git 还提供了一个stash功能，可以把当前工作现场“储藏”起来，等以后恢复现场后继续工作:</span></span><br><span class="line">git stash</span><br><span class="line">git stash list <span class="comment"># list stash working directory</span></span><br><span class="line">git stash apply <span class="comment"># 恢复 stash 内容</span></span><br><span class="line">git stash apply stash@&#123;<span class="number">0</span>&#125; <span class="comment"># 恢复指定stash</span></span><br><span class="line">git stash stop <span class="comment"># 删除 stash 内容</span></span><br><span class="line">git stash pop <span class="comment"># 恢复同时删除 stash 内容</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># example</span></span><br><span class="line">➜  learngo git:(master) ✗ git status</span><br><span class="line">On branch master</span><br><span class="line">Your branch is ahead of <span class="string">'origin/master'</span> by <span class="number">7</span> commits.</span><br><span class="line">  (use <span class="string">"git push"</span> to publish your <span class="built_in">local</span> commits)</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use <span class="string">"git reset HEAD &lt;file&gt;..."</span> to unstage)</span><br><span class="line"></span><br><span class="line">	new file:   <span class="built_in">test</span>_stash</span><br><span class="line"></span><br><span class="line">➜  learngo git:(master) ✗ </span><br><span class="line">➜  learngo git:(master) ✗ </span><br><span class="line">➜  learngo git:(master) ✗ git stash</span><br><span class="line">Saved working directory and index state WIP on master: <span class="number">43034</span>bd modify .gitignore</span><br><span class="line">HEAD is now at <span class="number">43034</span>bd modify .gitignore</span><br><span class="line">➜  learngo git:(master) git status</span><br><span class="line">On branch master</span><br><span class="line">Your branch is ahead of <span class="string">'origin/master'</span> by <span class="number">7</span> commits.</span><br><span class="line">  (use <span class="string">"git push"</span> to publish your <span class="built_in">local</span> commits)</span><br><span class="line">nothing to commit, working directory clean</span><br><span class="line">➜  learngo git:(master) </span><br><span class="line"><span class="comment"># 当你在DEV下改了一个文件，然后add到暂存区，不 commit，然后 checkout -b issue 到，你会发现你在dev下修改的文件也被带到了 issue 下，git status 一下暂存区的内容也在，然后你在 issue 下修改然后 commit，那么也就意味着之前dev下的修改都被提交到了issue下面，那么再回到dev，当然你之前dev下的修改都没有了，我猜想是暂存区可能是只有一个，而不是每个分支各有一个暂存区。如果那样的话就没必要有git stash了。</span></span><br></pre></td></tr></table></figure>
<h2 id="强制删除分支">强制删除分支</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git branch -D feature-vulcan</span><br><span class="line"><span class="comment"># 如果要丢弃一个没有被合并过的分支，可以通过git branch -D &lt;name&gt;强行删除。</span></span><br></pre></td></tr></table></figure>
<h2 id="多人协作">多人协作</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">git remote <span class="comment"># 查看远程库</span></span><br><span class="line">git remote -v <span class="comment"># 显示详情</span></span><br><span class="line"></span><br><span class="line">git push origin master <span class="comment"># 推送</span></span><br><span class="line">git push origin dev <span class="comment"># 推送 dev 分支</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 并不是一定要把本地分支往远程推送，那么，哪些分支需要推送，哪些不需要呢？</span></span><br><span class="line"><span class="comment">#   master分支是主分支，因此要时刻与远程同步；</span></span><br><span class="line"><span class="comment">#   dev分支是开发分支，团队所有成员都需要在上面工作，所以也需要与远程同步；</span></span><br><span class="line"><span class="comment">#   bug分支只用于在本地修复bug，就没必要推到远程了，除非老板要看看你每周到底修复了几个bug；</span></span><br><span class="line"><span class="comment">#   feature分支是否推到远程，取决于你是否和你的小伙伴合作在上面开发</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 多人协作的工作模式通常是这样：</span></span><br><span class="line"><span class="comment"># 首先，可以试图用git push origin branch-name推送自己的修改；</span></span><br><span class="line"><span class="comment"># 如果推送失败，则因为远程分支比你的本地更新，需要先用git pull试图合并；</span></span><br><span class="line"><span class="comment"># 如果合并有冲突，则解决冲突，并在本地提交；</span></span><br><span class="line"><span class="comment"># 没有冲突或者解决掉冲突后，再用git push origin branch-name推送就能成功！</span></span><br><span class="line"><span class="comment"># 如果git pull提示“no tracking information”，则说明本地分支和远程分支的链接关系没有创建，用命令git branch --set-upstream branch-name origin/branch-name 关联。</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看远程库信息，使用git remote -v；</span></span><br><span class="line"><span class="comment"># 本地新建的分支如果不推送到远程，对其他人就是不可见的；</span></span><br><span class="line"><span class="comment"># 从本地推送分支，使用git push origin branch-name，如果推送失败，先用git pull抓取远程的新提交；</span></span><br><span class="line"><span class="comment"># 在本地创建和远程分支对应的分支，使用git checkout -b branch-name origin/branch-name，本地和远程分支的名称最好一致；</span></span><br><span class="line"><span class="comment"># 建立本地分支和远程分支的关联，使用git branch --set-upstream branch-name origin/branch-name；</span></span><br><span class="line"><span class="comment"># 从远程抓取分支，使用git pull，如果有冲突，要先处理冲突。</span></span><br></pre></td></tr></table></figure>
<h2 id="标签管理">标签管理</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 发布一个版本时，我们通常先在版本库中打一个标签，这样，就唯一确定了打标签时刻的版本。将来无论什么时候，取某个标签的版本，就是把那个打标签的时刻的历史版本取出来。所以，标签也是版本库的一个快照。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Git 的标签虽然是版本库的快照，但其实它就是指向某个 commit 的指针（跟分支很像对不对？但是分支可以移动，标签不能移动），所以，创建和删除标签都是瞬间完成的。</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">git tag <span class="comment"># 查看所有 标签</span></span><br><span class="line">git tag v1.<span class="number">0</span> <span class="comment"># 打标签，默认打在最新提交的 commit 上</span></span><br><span class="line">git tag v0.<span class="number">9</span> <span class="number">6224937</span> <span class="comment"># 为 6224937 这次commit 打标签</span></span><br><span class="line">git show &lt;tagname&gt; <span class="comment"># 查看标签信息，注意，标签不是按时间顺序列出，而是按字母排序的。</span></span><br><span class="line">git tag <span class="operator">-a</span> v0.<span class="number">1</span> -m <span class="string">"version 0.1 released"</span> <span class="number">6224937</span> <span class="comment">#  可以创建带有说明的标签，用-a指定标签名，-m指定说明文字</span></span><br><span class="line">git tag <span class="operator">-s</span> v0.<span class="number">2</span> -m <span class="string">"signed version 0.2 released"</span> fec145a <span class="comment"># 通过 -s 用私钥签名一个标签</span></span><br><span class="line"><span class="comment"># 签名采用PGP签名，因此，必须首先安装gpg（GnuPG），如果没有找到gpg，或者没有gpg密钥对，就会报错：</span></span><br><span class="line"><span class="comment"># gpg: signing failed: secret key not available</span></span><br><span class="line"><span class="comment"># error: gpg failed to sign the data</span></span><br><span class="line"><span class="comment"># error: unable to sign the tag</span></span><br><span class="line"><span class="comment"># 如果报错，请参考GnuPG帮助文档配置Key。</span></span><br><span class="line"><span class="comment"># 用命令git show &lt;tagname&gt;可以看到PGP签名信息，用PGP签名的标签是不可伪造的，因为可以验证PGP签名。</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 命令git tag &lt;name&gt;用于新建一个标签，默认为HEAD，也可以指定一个commit id；</span></span><br><span class="line"><span class="comment"># git tag -a &lt;tagname&gt; -m "blablabla..."可以指定标签信息；</span></span><br><span class="line"><span class="comment"># git tag -s &lt;tagname&gt; -m "blablabla..."可以用PGP签名标签；</span></span><br><span class="line"><span class="comment"># 命令git tag可以查看所有标签。</span></span><br></pre></td></tr></table></figure>
<h2 id="操作标签">操作标签</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">git tag <span class="operator">-d</span> v0.<span class="number">1</span> <span class="comment"># 删除标签</span></span><br><span class="line"><span class="comment"># 因为创建的标签都只存储在本地，不会自动推送到远程。所以，打错的标签可以在本地安全删除。</span></span><br><span class="line"></span><br><span class="line">git push origin v1.<span class="number">0</span></span><br><span class="line"><span class="comment"># 如果要推送某个标签到远程，使用命令git push origin &lt;tagname&gt;</span></span><br><span class="line"></span><br><span class="line">git push origin --tags <span class="comment">#一次性推送全部尚未推送到远程的本地标签</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 标签已经推送到远程，要删除远程标签就麻烦一点，先从本地删除, 然后，从远程删除。删除命令也是push</span></span><br><span class="line">git tag <span class="operator">-d</span> v0.<span class="number">9</span></span><br><span class="line">git push origin :refs/tags/v0.<span class="number">9</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 命令git push origin &lt;tagname&gt; 可以推送一个本地标签；</span></span><br><span class="line"><span class="comment"># 命令git push origin --tags 可以推送全部未推送过的本地标签；</span></span><br><span class="line"><span class="comment"># 命令git tag -d &lt;tagname&gt; 可以删除一个本地标签；</span></span><br><span class="line"><span class="comment"># 命令git push origin :refs/tags/&lt;tagname&gt; 可以删除一个远程标签。</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除远程branch可以用，git push origin :&lt;branch name&gt;</span></span><br><span class="line"><span class="comment"># 类比思路我发现可以用 git push orgigin :&lt;tag name&gt;直接删除远程tag，而本地的不会改变。</span></span><br></pre></td></tr></table></figure>
<h2 id="忽略特殊文件">忽略特殊文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在Git工作区的根目录下创建一个特殊的.gitignore文件，然后把要忽略的文件名填进去，Git就会自动忽略这些文件。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 不需要从头写.gitignore文件，GitHub已经为我们准备了各种配置文件，只需要组合一下就可以使用了。所有配置文件可以直接在线浏览：https://github.com/github/gitignore</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 最后一步就是把 .gitignore 也提交到Git，就完成了！当然检验 .gitignore 的标准是 git status 命令是不是说 working directory clean。</span></span><br></pre></td></tr></table></figure>
<h2 id="配置别名">配置别名</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global alias.st status</span><br><span class="line">$ git config --global alias.co checkout</span><br><span class="line">$ git config --global alias.ci commit</span><br><span class="line">$ git config --global alias.br branch</span><br><span class="line"></span><br><span class="line">$ git ci -m <span class="string">"bala bala bala..."</span></span><br><span class="line">$ git config --global alias.unstage <span class="string">'reset HEAD'</span></span><br><span class="line">$ git unstage test.py <span class="comment">## 等于 $ git reset HEAD test.py</span></span><br><span class="line">$ git config --global alias.last <span class="string">'log -1'</span> <span class="comment"># 最近一次提交</span></span><br><span class="line">$ git config --global alias.lg <span class="string">"log --color --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset' --abbrev-commit"</span></span><br></pre></td></tr></table></figure>
<h2 id="创建_git_远程仓库">创建 git 远程仓库</h2><h3 id="install_git">install git</h3><pre><code>aptitude <span class="keyword">install</span> git
aptitude <span class="keyword">install</span> git-core
</code></pre><h3 id="add_user_git">add user git</h3><pre><code>useradd git
modify <span class="regexp">/etc/</span>passwd
<span class="regexp">/bin/</span>bash to <span class="regexp">/usr/</span>bin<span class="regexp">/git-shell</span>
</code></pre><h3 id="config_no_pass_login">config no pass login</h3><pre><code>cat user_id_rsa.pub &gt;&gt; <span class="regexp">/home/git</span><span class="regexp">/.ssh/authorized</span>_keys
</code></pre><h3 id="init_repos">init repos</h3><pre><code><span class="title">cd</span> /<span class="typedef"><span class="keyword">data</span>/</span>
<span class="title">git</span> init <span class="comment">--bare mola.git</span>
<span class="title">chown</span> -<span class="type">R</span> git:git mola.git
<span class="preprocessor"># or </span>
<span class="title">git</span> clone <span class="comment">--bare my_project my_project.git # 现有项目上创建裸仓库</span>
</code></pre><h3 id="git_clone_repos">git clone repos</h3><pre><code>git clone git<span class="variable">@server</span><span class="symbol">:/srv/mola</span>.git
git clone <span class="symbol">ssh:</span>/<span class="regexp">/git@45.78.3.30:27273/srv</span><span class="regexp">/mola.git # 指定 ssh 端口</span>
</code></pre>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-09-22T18:46:55.000Z"><a href="/2015/09/23/another-hexo-blog/">2015-09-23</a></time>
      
      
  
    <h1 class="title"><a href="/2015/09/23/another-hexo-blog/">基于 hexo 博客安装配置</a></h1>
  

    </header>
    <div class="entry">
      
        <p>Reference: <a href="https://hexo.io/docs/" target="_blank" rel="external">hexo</a> <a href="https://github.com/creationix/nvm" target="_blank" rel="external">nvm</a></p>
<h2 id="requirememnts">requirememnts</h2><h3 id="git">git</h3><p><strong>git installation</strong></p>
<pre><code>aptitude <span class="keyword">install</span> git
</code></pre><h3 id="node-js">node.js</h3><p><strong>nvm installation</strong><br> nvm: node version management</p>
<pre><code>curl http<span class="variable">s:</span>//raw.github.<span class="keyword">com</span>/creationix/nvm/master/install.<span class="keyword">sh</span> | <span class="keyword">sh</span>
</code></pre><p><strong>nvm configuration</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat .zshrc</span><br><span class="line"><span class="built_in">export</span> NVM_DIR=<span class="string">"/home/shm/.nvm"</span></span><br><span class="line">[ <span class="operator">-s</span> <span class="string">"<span class="variable">$NVM_DIR</span>/nvm.sh"</span> ] &amp;&amp; . <span class="string">"<span class="variable">$NVM_DIR</span>/nvm.sh"</span>  <span class="comment"># This loads nvm</span></span><br><span class="line"></span><br><span class="line">nvm use <span class="number">4.1</span>.<span class="number">0</span> &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br></pre></td></tr></table></figure></p>
<p><strong>nvm commands</strong></p>
<pre><code>nvm <span class="built_in">list</span>
nvm install v4<span class="number">.10</span> <span class="comment">//nvm install stable/unstable</span>
nvm use <span class="number">4.10</span> <span class="comment">//nvm use stable/unstable</span>
nvm current
</code></pre><h2 id="hexo_install">hexo install</h2><pre><code>npm <span class="operator"><span class="keyword">install</span> -<span class="keyword">g</span> hexo-cli</span>
</code></pre><h2 id="hexo_setup">hexo setup</h2><pre><code>hexo init <span class="tag">&lt;<span class="title">folder</span>&gt;</span>
cd  <span class="tag">&lt;<span class="title">folder</span>&gt;</span>
npm install
</code></pre><h2 id="hexo_configuration">hexo configuration</h2><p><strong>_config.yml</strong> avaliable config:</p>
<ul>
<li>site</li>
<li>url</li>
<li>directory</li>
<li>writing</li>
<li>catagory &amp; tag</li>
<li>date / time format</li>
<li>pagination</li>
<li>extensions</li>
</ul>
<h2 id="hexo_commands">hexo commands</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">➜  hexo  hexo -h </span><br><span class="line">Usage: hexo &lt;<span class="built_in">command</span>&gt;</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  clean     Removed generated files and cache.</span><br><span class="line">  config    Get or <span class="built_in">set</span> configurations.</span><br><span class="line">  deploy    Deploy your website.</span><br><span class="line">  generate  Generate static files.</span><br><span class="line">  <span class="built_in">help</span>      Get <span class="built_in">help</span> on a command.</span><br><span class="line">  init      Create a new Hexo folder.</span><br><span class="line">  list      List the information of the site</span><br><span class="line">  migrate   Migrate your site from other system to Hexo.</span><br><span class="line">  new       Create a new post.</span><br><span class="line">  publish   Moves a draft post from _drafts to _posts folder.</span><br><span class="line">  render    Render files with renderer plugins.</span><br><span class="line">  server    Start the server.</span><br><span class="line">  version   Display version information.</span><br><span class="line"></span><br><span class="line">Global Options:</span><br><span class="line">  --config  Specify config file instead of using _config.yml</span><br><span class="line">  --cwd     Specify the CWD</span><br><span class="line">  --debug   Display all verbose messages <span class="keyword">in</span> the terminal</span><br><span class="line">  --draft   Display draft posts</span><br><span class="line">  --safe    Disable all plugins and scripts</span><br><span class="line">  --silent  Hide output on console</span><br><span class="line"></span><br><span class="line">For more <span class="built_in">help</span>, you can use <span class="string">'hexo help [command]'</span> <span class="keyword">for</span> the detailed information</span><br><span class="line">or you can check the docs: http://hexo.io/docs/</span><br></pre></td></tr></table></figure>
<h2 id="hexo_deploy">hexo deploy</h2><pre><code>npm <span class="operator"><span class="keyword">install</span> hexo-deployer-git <span class="comment">--save</span></span>
</code></pre><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat _config.yml</span><br><span class="line">deploy:</span><br><span class="line">  <span class="built_in">type</span>: git</span><br><span class="line">  repository: git@github.com:suhaiming/suhaiming.github.io.git</span><br><span class="line">  branch: master</span><br></pre></td></tr></table></figure>
<h2 id="hexo_themes_configuration">hexo themes configuration</h2><pre><code>git clone git<span class="annotation">@github</span>.<span class="string">com:</span>iissnan<span class="regexp">/hexo-theme-next.git themes/</span>next
git clone <span class="string">git:</span><span class="comment">//github.com/tommy351/hexo-theme-light.git theme/light </span>
</code></pre><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat _config.yml</span><br><span class="line">theme: light</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





<nav id="pagination">
  
  
  <div class="clearfix"></div>
</nav></div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:imshm.tk">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">Categories</h3>
  <ul class="entry">
  
    <li><a href="/categories/tech/">tech</a><small>5</small></li>
  
    <li><a href="/categories/work/">work</a><small>1</small></li>
  
  </ul>
</div>


  
<div class="widget tagcloud">
  <h3 class="title">Tag Cloud</h3>
  <div class="entry">
    <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/iis/" style="font-size: 10px;">iis</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/log-parser/" style="font-size: 10px;">log parser</a> <a href="/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/tags/server/" style="font-size: 10px;">server</a> <a href="/tags/ssh/" style="font-size: 10px;">ssh</a>
  </div>
</div>


  
<div class="widget tag">
  <h3 class="title">Recent Posts</h3>
  <ul class="entry">
    
      <li>
        <a href="/2015/09/26/security-configuration-for-linux-root-user/">Root 安全配置</a>
      </li>
    
      <li>
        <a href="/2015/09/26/hotlink-protection-in-nginx/">Nginx 防盗链设置</a>
      </li>
    
      <li>
        <a href="/2015/09/24/lookup-server-information-by-ip-address/">通过 IP 查找服务器</a>
      </li>
    
      <li>
        <a href="/2015/09/24/how-to-deal-with-server-fault/">服务器故障处理及日志分析</a>
      </li>
    
      <li>
        <a href="/2015/09/24/git-learning/">Git 学习笔记</a>
      </li>
    
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2015 shm
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




</body>
</html>